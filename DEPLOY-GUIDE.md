# üöÄ Guia de Deploy Gratuito - EmpresaX.POS

## ‚ö†Ô∏è IMPORTANTE: Sobre o Azure

**Azure N√ÉO √© gr√°tis permanentemente!**
- ‚úÖ App Service F1: Gr√°tis **para sempre**
- ‚è∞ PostgreSQL: Gr√°tis apenas **12 meses**, depois cobra ~R$ 50-100/m√™s
- ‚è∞ Per√≠odo gratuito: Apenas para **novos usu√°rios**

**Para deploy gratuito PERMANENTE, use Railway ou Render!**

---

## üìã Vis√£o Geral

Este guia apresenta **op√ß√µes de deploy gratuito** para o sistema **EmpresaX.POS** (backend .NET + frontend React):

### ‚úÖ Op√ß√µes Gratuitas PERMANENTES:
1. **Railway.app** - $5 cr√©dito/m√™s (suficiente para pequenos projetos)
2. **Render.com** - 100% gr√°tis (com cold starts)

### ‚ö†Ô∏è Op√ß√£o Tempor√°ria (12 meses):
3. **Azure** - Gr√°tis 12 meses, depois cobra

**Inclu√≠do no deploy:**
- ‚úÖ Backend API (.NET 8)
- ‚úÖ Frontend React
- ‚úÖ Banco de dados PostgreSQL
- ‚úÖ CI/CD autom√°tico
- ‚úÖ Monitoramento b√°sico

**Custo Total Permanente:** R$ 0,00/m√™s üí∞ (Railway ou Render)

---

## üéØ Op√ß√µes de Deploy Gratuito

### Op√ß√£o 1: Railway.app (Recomendado) üåü

**Por que escolher:**
- ‚úÖ Deploy autom√°tico via GitHub
- ‚úÖ PostgreSQL incluso
- ‚úÖ HTTPS autom√°tico
- ‚úÖ $5/m√™s de cr√©ditos gr√°tis (suficiente para pequenos projetos)
- ‚úÖ Logs em tempo real

**Limita√ß√µes:**
- 500 horas/m√™s (mais que suficiente)
- Ap√≥s cr√©ditos, servi√ßo dorme ap√≥s inatividade

---

### Op√ß√£o 2: Render.com üÜì

**Por que escolher:**
- ‚úÖ Totalmente gratuito
- ‚úÖ PostgreSQL gratuito (90 dias, depois renov√°vel)
- ‚úÖ Deploy autom√°tico
- ‚úÖ HTTPS autom√°tico

**Limita√ß√µes:**
- Servi√ßo dorme ap√≥s 15min de inatividade
- Cold start de ~30 segundos

---

### Op√ß√£o 3: Azure (12 Meses Gr√°tis para Novos Usu√°rios) ‚òÅÔ∏è

**Por que escolher:**
- ‚úÖ App Service gratuito (F1) - **sempre gr√°tis**
- ‚úÖ PostgreSQL Flexible Server (B1ms) - **12 meses gr√°tis**
- ‚úÖ 750h/m√™s de VM B1S - **12 meses gr√°tis**
- ‚úÖ Application Insights incluso
- ‚úÖ Professional grade
- ‚úÖ $200 em cr√©ditos nos primeiros 30 dias

**Limita√ß√µes:**
- ‚ö†Ô∏è **12 meses gr√°tis apenas para novos usu√°rios**
- ‚ö†Ô∏è Ap√≥s 12 meses, PostgreSQL passa a cobrar (~R$ 50-100/m√™s)
- Requer cart√£o de cr√©dito (sem cobran√ßa nos limites gr√°tis)
- Mais complexo de configurar
- App Service F1 continua gr√°tis ap√≥s 12 meses

---

## üöÄ Deploy no Railway.app (Op√ß√£o Mais F√°cil)

### Pr√©-requisitos
- Conta no [Railway.app](https://railway.app)
- Reposit√≥rio no GitHub
- Projeto funcionando localmente

### Passo 1: Preparar o Backend

#### 1.1 Criar `railway.json` na raiz do projeto API

```json
{
  "build": {
    "builder": "NIXPACKS",
    "buildCommand": "dotnet publish -c Release -o out"
  },
  "deploy": {
    "startCommand": "dotnet out/EmpresaX.POS.API.dll",
    "healthcheckPath": "/health",
    "healthcheckTimeout": 100,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  }
}
```

#### 1.2 Atualizar `appsettings.json` para usar vari√°veis de ambiente

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "${DATABASE_URL}"
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information"
    }
  },
  "AllowedHosts": "*",
  "Cors": {
    "Origins": "${CORS_ORIGINS:http://localhost:3000}"
  }
}
```

#### 1.3 Modificar `Program.cs` para Railway

```csharp
// Adicionar suporte a porta do Railway
var port = Environment.GetEnvironmentVariable("PORT") ?? "5000";
builder.WebHost.UseUrls($"http://0.0.0.0:{port}");

// Configurar PostgreSQL do Railway
var connectionString = builder.Configuration.GetConnectionString("DefaultConnection");
if (!string.IsNullOrEmpty(connectionString) && connectionString.Contains("DATABASE_URL"))
{
    // Railway fornece URL no formato postgres://user:pass@host:port/db
    connectionString = Environment.GetEnvironmentVariable("DATABASE_URL");
    builder.Services.AddDbContext<ApplicationDbContext>(options =>
        options.UseNpgsql(connectionString));
}
```

### Passo 2: Deploy do Backend no Railway

#### 2.1 Criar novo projeto

1. Acesse [railway.app](https://railway.app)
2. Clique em **"New Project"**
3. Selecione **"Deploy from GitHub repo"**
4. Autorize o Railway no GitHub
5. Selecione o reposit√≥rio do projeto

#### 2.2 Adicionar PostgreSQL

1. No projeto Railway, clique em **"+ New"**
2. Selecione **"Database"** ‚Üí **"PostgreSQL"**
3. Railway criar√° automaticamente a vari√°vel `DATABASE_URL`

#### 2.3 Configurar Vari√°veis de Ambiente

No painel do servi√ßo da API, v√° em **"Variables"** e adicione:

```bash
# Conex√£o com banco (autom√°tica, j√° preenchida)
DATABASE_URL=postgresql://...

# CORS (URL do frontend que ser√° criado)
CORS_ORIGINS=https://seu-frontend.up.railway.app

# Ambiente
ASPNETCORE_ENVIRONMENT=Production

# JWT (gerar chave forte)
JWT_SECRET=SuaChaveSuperSecretaAqui123!@#
JWT_ISSUER=EmpresaX.POS
JWT_AUDIENCE=EmpresaX.POS.Users

# Serilog
Serilog__MinimumLevel__Default=Information
```

#### 2.4 Deploy

Railway far√° deploy automaticamente! Acompanhe os logs.

Sua API estar√° dispon√≠vel em: `https://empresax-api-production.up.railway.app`

### Passo 3: Deploy do Frontend no Railway

#### 3.1 Criar `railway.json` no projeto frontend

```json
{
  "build": {
    "builder": "NIXPACKS",
    "buildCommand": "npm install && npm run build"
  },
  "deploy": {
    "startCommand": "npm run start",
    "healthcheckPath": "/",
    "healthcheckTimeout": 100
  }
}
```

#### 3.2 Atualizar URL da API no frontend

Criar arquivo `.env.production`:

```bash
VITE_API_URL=https://empresax-api-production.up.railway.app/api/v1
```

No c√≥digo, usar:

```typescript
const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5000/api/v1';
```

#### 3.3 Adicionar servi√ßo frontend

1. No mesmo projeto Railway, clique em **"+ New"**
2. Selecione **"GitHub Repo"**
3. Escolha a pasta do frontend (ou mesmo repo)
4. Configure o **Root Directory** se necess√°rio

#### 3.4 Vari√°veis de ambiente do frontend

```bash
VITE_API_URL=https://empresax-api-production.up.railway.app/api/v1
NODE_ENV=production
```

### Passo 4: Configurar Custom Domain (Opcional)

1. No servi√ßo, v√° em **"Settings"** ‚Üí **"Domains"**
2. Clique em **"Generate Domain"** para subdom√≠nio gratuito
3. Ou configure seu pr√≥prio dom√≠nio

---

## üé® Deploy no Render.com (100% Gratuito)

### Passo 1: Backend no Render

#### 1.1 Criar Web Service

1. Acesse [render.com](https://render.com)
2. Clique em **"New +"** ‚Üí **"Web Service"**
3. Conecte seu reposit√≥rio GitHub
4. Configure:

```yaml
Name: empresax-api
Environment: Docker (ou .NET)
Branch: main
Build Command: dotnet publish -c Release -o out
Start Command: dotnet out/EmpresaX.POS.API.dll
```

#### 1.2 Vari√°veis de Ambiente

```bash
ASPNETCORE_ENVIRONMENT=Production
ASPNETCORE_URLS=http://0.0.0.0:$PORT
DATABASE_URL=(ser√° preenchido ap√≥s criar o banco)
CORS_ORIGINS=https://seu-frontend.onrender.com
JWT_SECRET=SuaChaveSecreta123
```

### Passo 2: PostgreSQL no Render

1. Clique em **"New +"** ‚Üí **"PostgreSQL"**
2. Escolha o plano **Free**
3. Copie a **Internal Database URL**
4. Cole em `DATABASE_URL` no backend

**Importante:** PostgreSQL gratuito expira em 90 dias, mas pode ser renovado.

### Passo 3: Frontend no Render

#### 3.1 Criar Static Site

1. **"New +"** ‚Üí **"Static Site"**
2. Configure:

```yaml
Name: empresax-frontend
Build Command: npm install && npm run build
Publish Directory: dist (ou build)
```

#### 3.2 Vari√°veis de Ambiente

```bash
VITE_API_URL=https://empresax-api.onrender.com/api/v1
NODE_ENV=production
```

### Passo 4: Evitar Cold Starts (Opcional)

Use um servi√ßo como [cron-job.org](https://cron-job.org) para fazer ping na API a cada 10 minutos:

```bash
# Criar job para:
GET https://empresax-api.onrender.com/health
# A cada 10 minutos
```

---

## ‚òÅÔ∏è Deploy no Azure (12 Meses Gr√°tis)

### ‚ö†Ô∏è Importante sobre o Azure Free Tier

**O que √© gr√°tis para sempre:**
- ‚úÖ App Service F1 (frontend/backend)
- ‚úÖ 5 GB de armazenamento Blob
- ‚úÖ Application Insights (5 GB dados/m√™s)

**O que √© gr√°tis por 12 meses (novos usu√°rios):**
- ‚è∞ PostgreSQL Flexible Server B1ms (750h/m√™s)
- ‚è∞ VM B1S (750h/m√™s)
- ‚è∞ Ap√≥s 12 meses, come√ßa a cobrar!

**Recomenda√ß√£o:** Use Azure apenas se voc√™:
1. √â novo usu√°rio (tem 12 meses gr√°tis)
2. Planeja migrar ou pagar ap√≥s 12 meses
3. Quer $200 cr√©dito inicial
4. Precisa compliance/professional grade

**Para longo prazo gratuito, use Railway ou Render!**

### Pr√©-requisitos
- Conta Microsoft (nova para ter 12 meses gr√°tis)
- Azure CLI instalado
- Cart√£o de cr√©dito (sem cobran√ßa nos limites gr√°tis)

### Passo 1: Backend no Azure App Service

#### 1.1 Criar Resource Group

```powershell
# Login
az login

# Criar resource group
az group create --name empresax-rg --location brazilsouth

# Criar App Service Plan (Free F1)
az appservice plan create `
  --name empresax-plan `
  --resource-group empresax-rg `
  --sku F1 `
  --is-linux
```

#### 1.2 Criar Web App

```powershell
az webapp create `
  --name empresax-api `
  --resource-group empresax-rg `
  --plan empresax-plan `
  --runtime "DOTNET|8.0"
```

#### 1.3 Configurar Deployment

```powershell
# Configurar deploy do GitHub
az webapp deployment source config `
  --name empresax-api `
  --resource-group empresax-rg `
  --repo-url https://github.com/seu-usuario/seu-repo `
  --branch main `
  --manual-integration
```

#### 1.4 Configurar Vari√°veis

```powershell
az webapp config appsettings set `
  --name empresax-api `
  --resource-group empresax-rg `
  --settings `
    ASPNETCORE_ENVIRONMENT=Production `
    DATABASE_URL="sua-connection-string" `
    JWT_SECRET="sua-chave"
```

### Passo 2: PostgreSQL no Azure

```powershell
# Criar PostgreSQL Flexible Server (B1ms - 12 meses gr√°tis)
az postgres flexible-server create `
  --name empresax-db `
  --resource-group empresax-rg `
  --location brazilsouth `
  --admin-user adminuser `
  --admin-password "SenhaForte123!" `
  --sku-name Standard_B1ms `
  --tier Burstable `
  --version 14 `
  --storage-size 32

# Permitir acesso do App Service
az postgres flexible-server firewall-rule create `
  --name empresax-db `
  --resource-group empresax-rg `
  --rule-name AllowAzureServices `
  --start-ip-address 0.0.0.0 `
  --end-ip-address 0.0.0.0
```

### Passo 3: Frontend no Azure Static Web Apps

```powershell
# Static Web Apps √© GR√ÅTIS para sempre!
az staticwebapp create `
  --name empresax-frontend `
  --resource-group empresax-rg `
  --source https://github.com/seu-usuario/seu-repo `
  --location "Brazil South" `
  --branch main `
  --app-location "/empresax-frontend" `
  --output-location "dist"
```

---

## üóÑÔ∏è Op√ß√µes de Banco de Dados Gratuito

### 1. **Supabase PostgreSQL** (Recomendado)
- ‚úÖ 500 MB storage
- ‚úÖ Sempre online
- ‚úÖ Backup autom√°tico
- ‚úÖ Dashboard visual
- üîó [supabase.com](https://supabase.com)

**Como usar:**
1. Criar projeto no Supabase
2. Copiar connection string
3. Usar no `appsettings.json`

### 2. **ElephantSQL**
- ‚úÖ 20 MB storage
- ‚úÖ PostgreSQL gerenciado
- üîó [elephantsql.com](https://elephantsql.com)

### 3. **Neon.tech**
- ‚úÖ 3 GB storage
- ‚úÖ Serverless PostgreSQL
- ‚úÖ Branching de banco de dados
- üîó [neon.tech](https://neon.tech)

---

## üîí Configura√ß√µes de Seguran√ßa para Produ√ß√£o

### 1. Configurar HTTPS Only

**Railway/Render:** Autom√°tico ‚úÖ

**Azure:**
```powershell
az webapp update `
  --name empresax-api `
  --resource-group empresax-rg `
  --https-only true
```

### 2. Configurar CORS Correto

```csharp
// Program.cs
builder.Services.AddCors(options =>
{
    options.AddPolicy("Production", policy =>
    {
        var allowedOrigins = builder.Configuration["CORS_ORIGINS"]?.Split(',') 
            ?? new[] { "https://seu-frontend.com" };
            
        policy.WithOrigins(allowedOrigins)
              .AllowedMethods("GET", "POST", "PUT", "DELETE")
              .AllowedHeaders("Content-Type", "Authorization")
              .AllowCredentials();
    });
});

app.UseCors("Production");
```

### 3. Configurar Secrets Seguros

**Nunca commite:**
- ‚ùå Connection strings
- ‚ùå JWT secrets
- ‚ùå API keys

**Use vari√°veis de ambiente em todos os deploys!**

### 4. Habilitar Rate Limiting

```csharp
// J√° documentado no SECURITY-GUIDE.md
builder.Services.AddRateLimiter(/* ... */);
```

---

## üìä Monitoramento Gratuito

### 1. **UptimeRobot** (Recomendado)
- ‚úÖ 50 monitores gratuitos
- ‚úÖ Alertas por email
- ‚úÖ Status page p√∫blico
- üîó [uptimerobot.com](https://uptimerobot.com)

**Configura√ß√£o:**
1. Criar conta
2. Adicionar monitor HTTP(S)
3. URL: `https://sua-api.com/health`
4. Intervalo: 5 minutos

### 2. **Better Uptime**
- ‚úÖ Monitoramento de uptime
- ‚úÖ Alertas (email, Slack, SMS)
- ‚úÖ Status page
- üîó [betteruptime.com](https://betteruptime.com)

### 3. **Sentry (Errors)**
- ‚úÖ 5.000 eventos/m√™s gr√°tis
- ‚úÖ Rastreamento de erros
- ‚úÖ Performance monitoring
- üîó [sentry.io](https://sentry.io)

**Integra√ß√£o:**
```powershell
dotnet add package Sentry.AspNetCore
```

```csharp
// Program.cs
builder.WebHost.UseSentry(options =>
{
    options.Dsn = "https://sua-dsn@sentry.io/projeto";
    options.TracesSampleRate = 1.0;
});
```

---

## üö¶ Checklist de Deploy

### Antes do Deploy
- [ ] Testes passando localmente
- [ ] Build sem erros
- [ ] Migrations prontas
- [ ] Vari√°veis de ambiente documentadas
- [ ] CORS configurado
- [ ] JWT secrets gerados
- [ ] Health check endpoint funcionando

### Durante o Deploy
- [ ] Connection string configurada
- [ ] HTTPS habilitado
- [ ] Vari√°veis de ambiente configuradas
- [ ] Migrations executadas
- [ ] Logs funcionando

### Ap√≥s o Deploy
- [ ] API respondendo (teste `/health`)
- [ ] Frontend carregando
- [ ] Autentica√ß√£o funcionando
- [ ] Banco de dados conectado
- [ ] Monitoramento configurado
- [ ] Backup configurado

---

## üÜò Troubleshooting Comum

### Problema: "Connection refused" no PostgreSQL

**Solu√ß√£o:**
```csharp
// Verificar formato da connection string
// Railway/Render usam formato especial:
postgres://user:password@host:5432/database

// Converter para formato .NET:
Host=host;Port=5432;Database=database;Username=user;Password=password;SSL Mode=Require
```

### Problema: CORS errors

**Solu√ß√£o:**
1. Verificar `CORS_ORIGINS` nas vari√°veis de ambiente
2. Incluir protocolo completo: `https://frontend.com`
3. Sem barra final: ‚ùå `https://frontend.com/`

### Problema: 502 Bad Gateway

**Solu√ß√£o:**
1. Verificar porta: usar `$PORT` ou `PORT` environment variable
2. Bind em `0.0.0.0`, n√£o `localhost`
3. Verificar logs: `railway logs` ou Render dashboard

### Problema: Cold starts lentos (Render)

**Solu√ß√£o:**
1. Usar cron-job.org para fazer ping a cada 10min
2. Otimizar startup (remover seeds desnecess√°rios)
3. Considerar upgrade para plano pago (~$7/m√™s)

---

## üí∞ Compara√ß√£o de Custos

| Servi√ßo | Gr√°tis | Limita√ß√µes | Upgrade | Permanente? |
|---------|--------|------------|---------|-------------|
| **Railway** | $5 cr√©dito/m√™s | 500h/m√™s, dorme | $5/m√™s | ‚úÖ Sim |
| **Render** | ‚úÖ Gr√°tis | Cold starts | $7/m√™s | ‚úÖ Sim |
| **Azure** | ‚è∞ 12 meses | Requer cart√£o, depois cobra | Vari√°vel | ‚ùå N√£o* |
| **Supabase DB** | ‚úÖ Gr√°tis | 500 MB | $25/m√™s | ‚úÖ Sim |
| **UptimeRobot** | ‚úÖ Gr√°tis | 50 monitores | $7/m√™s | ‚úÖ Sim |

**\*Azure App Service F1 √© gr√°tis para sempre, mas PostgreSQL cobra ap√≥s 12 meses (~R$ 50-100/m√™s)**

### Custo Ap√≥s 12 Meses

| Op√ß√£o | Meses 1-12 | Ap√≥s 12 meses |
|-------|------------|---------------|
| **Railway + Supabase** | R$ 0 | R$ 0 (cr√©dito mensal) |
| **Render + Supabase** | R$ 0 | R$ 0 |
| **Azure** | R$ 0 | R$ 50-100/m√™s* |

**\*Azure PostgreSQL come√ßa a cobrar ap√≥s per√≠odo gratuito**

**Total Recomendado:** **R$ 0,00/m√™s para sempre** (Railway $5 cr√©dito + Render Frontend + Supabase DB)

---

## üéØ Recomenda√ß√£o Final

### Para Desenvolvimento/MVP/Produ√ß√£o Pequena (MELHOR OP√á√ÉO):
‚úÖ **Railway.app** (Backend + PostgreSQL) + **Render** (Frontend)
- ‚úÖ Deploy mais f√°cil
- ‚úÖ **Gr√°tis para sempre** (Railway $5 cr√©dito mensal)
- ‚úÖ Logs em tempo real
- ‚úÖ Sem cold starts no Railway
- ‚úÖ PostgreSQL incluso

### Para Produ√ß√£o 100% Gratuita (ZERO CUSTO):
‚úÖ **Render.com** (Backend + Frontend) + **Supabase** (PostgreSQL)
- ‚úÖ **100% gratuito para sempre**
- ‚úÖ Supabase com backup autom√°tico
- ‚úÖ Sem necessidade de cart√£o
- ‚ö†Ô∏è Cold starts ap√≥s 15min inatividade
- **Solu√ß√£o:** Configurar cron-job.org para ping a cada 10min

### Para Produ√ß√£o Profissional com Budget:
‚úÖ **Railway Paid** ($5-20/m√™s) ou **Render Paid** ($7+/m√™s)
- ‚úÖ Sem cold starts
- ‚úÖ Melhor performance
- ‚úÖ Suporte profissional
- ‚úÖ Escalabilidade

### ‚ö†Ô∏è Azure (N√ÉO Recomendado para Gr√°tis Permanente):
‚ùå **N√£o use Azure** se quer gr√°tis permanente
- ‚ö†Ô∏è Gr√°tis apenas **12 meses**
- ‚ö†Ô∏è PostgreSQL cobra ap√≥s per√≠odo (~R$ 50-100/m√™s)
- ‚úÖ Use apenas se:
  - Voc√™ √© novo usu√°rio e quer $200 cr√©dito inicial
  - Planeja pagar ap√≥s 12 meses
  - Precisa compliance/certifica√ß√µes
  - Empresa j√° usa Azure

---

## üìö Recursos Adicionais

### Documenta√ß√£o Oficial
- [Railway Docs](https://docs.railway.app)
- [Render Docs](https://render.com/docs)
- [Azure Docs](https://docs.microsoft.com/azure)
- [Supabase Docs](https://supabase.com/docs)

### Tutoriais em V√≠deo
- [Deploy .NET no Railway (YouTube)](https://youtube.com/watch?v=...)
- [Deploy React no Render (YouTube)](https://youtube.com/watch?v=...)

### Comunidades
- [Railway Discord](https://discord.gg/railway)
- [Render Community](https://community.render.com)
- [Azure Brasil](https://www.meetup.com/pt-BR/azurebr/)

---

## üöÄ Quick Start (5 minutos)

```bash
# 1. Clone o projeto
git clone https://github.com/seu-usuario/empresax-pos.git
cd empresax-pos

# 2. Configure vari√°veis locais
cp .env.example .env

# 3. Teste localmente
dotnet run --project src/EmpresaX.POS.API
cd empresax-frontend && npm run dev

# 4. Commit e push
git add .
git commit -m "Ready for deploy"
git push

# 5. Deploy no Railway
# - Acesse railway.app
# - New Project ‚Üí GitHub Repo
# - Adicione PostgreSQL
# - Configure vari√°veis
# - Deploy autom√°tico! üéâ
```

---

**√öltima Atualiza√ß√£o:** 20 de outubro de 2025  
**Autor:** GitHub Copilot  
**Custo Total:** **R$ 0,00/m√™s** üí∞‚ú®
